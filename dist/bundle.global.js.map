{"version":3,"file":"bundle.global.js","sources":["../src/ratelimit.ts","../src/types.ts","../src/utils.ts","../src/get.ts","../src/update.ts","../src/append.ts","../src/delete.ts","../src/index.ts"],"sourcesContent":["/**\r\n * Exponential backoff handler for Google Sheets API calls\r\n * Handles rate limiting (429) and quota exceeded errors\r\n * @param fn Function to execute with retry logic\r\n * @param retries Maximum number of retry attempts (default: 16)\r\n * @returns Result of the function execution\r\n */\r\nexport function callHandler<T>(fn: () => T, retries: number = 16): T {\r\n  let attempt = 0;\r\n\r\n  while (attempt < retries) {\r\n    try {\r\n      return fn();\r\n    } catch (error: any) {\r\n      const errorMessage = error?.message || String(error);\r\n      \r\n      // Check if it's a rate limit or quota error\r\n      const isRateLimitError = \r\n        errorMessage.includes(\"429\") ||\r\n        errorMessage.includes(\"Quota exceeded\") ||\r\n        errorMessage.includes(\"Rate Limit Exceeded\");\r\n      \r\n      if (isRateLimitError) {\r\n        attempt++;\r\n        \r\n        if (attempt >= retries) {\r\n          throw new Error(\r\n            `Max retries (${retries}) reached for Google Sheets API call. Last error: ${errorMessage}`\r\n          );\r\n        }\r\n        \r\n        // Exponential backoff with jitter, capped at 64 seconds\r\n        const backoffDelay = Math.min(\r\n          Math.pow(2, attempt) * 1000 + Math.random() * 1000,\r\n          64000\r\n        );\r\n        \r\n        console.log(`Rate limit hit, retrying in ${Math.round(backoffDelay)}ms (attempt ${attempt}/${retries})`);\r\n        Utilities.sleep(backoffDelay);\r\n      } else {\r\n        // Not a rate limit error, rethrow immediately\r\n        throw error;\r\n      }\r\n    }\r\n  }\r\n\r\n  throw new Error(\"Unexpected state: Max retries reached without throwing error\");\r\n}\r\n","/**\r\n * Options for reading data from Google Sheets\r\n */\r\nexport type GQueryReadOptions = {\r\n  /** How values should be rendered in the output */\r\n  valueRenderOption?: ValueRenderOption;\r\n  /** How dates and times should be rendered in the output */\r\n  dateTimeRenderOption?: DateTimeRenderOption;\r\n};\r\n\r\n/**\r\n * Result structure returned by GQuery operations\r\n */\r\nexport type GQueryResult = {\r\n  /** Array of row objects */\r\n  rows: GQueryRow[];\r\n  /** Column headers from the sheet */\r\n  headers: string[];\r\n};\r\n\r\n/**\r\n * A single row with metadata about its position in the sheet\r\n */\r\nexport type GQueryRow = Record<string, any> & {\r\n  __meta: {\r\n    /** 1-based row number in the sheet (row 1 is headers) */\r\n    rowNum: number;\r\n    /** Number of columns in the row */\r\n    colLength: number;\r\n  };\r\n};\r\n\r\n/**\r\n * How values should be rendered in the output\r\n * @see https://developers.google.com/sheets/api/reference/rest/v4/ValueRenderOption\r\n */\r\nexport enum ValueRenderOption {\r\n  /** Values will be calculated and formatted according to cell formatting */\r\n  FORMATTED_VALUE = \"FORMATTED_VALUE\",\r\n  /** Values will be calculated but not formatted */\r\n  UNFORMATTED_VALUE = \"UNFORMATTED_VALUE\",\r\n  /** Values will not be calculated; formulas will be returned as-is */\r\n  FORMULA = \"FORMULA\",\r\n}\r\n\r\n/**\r\n * How dates and times should be rendered in the output\r\n * @see https://developers.google.com/sheets/api/reference/rest/v4/DateTimeRenderOption\r\n */\r\nexport enum DateTimeRenderOption {\r\n  /** Dates and times will be rendered as strings according to cell formatting */\r\n  FORMATTED_STRING = \"FORMATTED_STRING\",\r\n  /** Dates and times will be rendered as serial numbers */\r\n  SERIAL_NUMBER = \"SERIAL_NUMBER\",\r\n}\r\n","import { callHandler } from \"./ratelimit\";\r\nimport { GQueryRow } from \"./types\";\r\n\r\n/**\r\n * Parse raw sheet values into GQueryRow objects with metadata\r\n * @param headers Column headers from the sheet\r\n * @param values Raw values from the sheet (without header row)\r\n * @returns Array of GQueryRow objects\r\n */\r\nexport function parseRows(\r\n  headers: string[],\r\n  values: any[][]\r\n): GQueryRow[] {\r\n  return values.map((row, rowIndex) => {\r\n    const obj: GQueryRow = {\r\n      __meta: {\r\n        rowNum: rowIndex + 2, // +2 because header is row 1, data starts at row 2\r\n        colLength: headers.length,\r\n      },\r\n    } as GQueryRow;\r\n\r\n    headers.forEach((header: string, i: number) => {\r\n      obj[header] = row[i] !== undefined ? row[i] : \"\";\r\n    });\r\n\r\n    return obj;\r\n  });\r\n}\r\n\r\n/**\r\n * Fetch all data from a sheet including headers\r\n * @param spreadsheetId The ID of the spreadsheet\r\n * @param sheetName The name of the sheet to fetch\r\n * @returns Object containing headers and rows\r\n */\r\nexport function fetchSheetData(\r\n  spreadsheetId: string,\r\n  sheetName: string\r\n): { headers: string[]; rows: GQueryRow[] } {\r\n  const response = callHandler(() =>\r\n    Sheets.Spreadsheets!.Values!.get(spreadsheetId, sheetName)\r\n  );\r\n  \r\n  const values = response.values || [];\r\n\r\n  if (values.length === 0) {\r\n    return { headers: [], rows: [] };\r\n  }\r\n\r\n  const headers = values[0].map((h: any) => String(h));\r\n  const rows = parseRows(headers, values.slice(1));\r\n\r\n  return { headers, rows };\r\n}\r\n","import { GQuery, GQueryTable, GQueryTableFactory } from \"./index\";\r\nimport { callHandler } from \"./ratelimit\";\r\nimport {\r\n  GQueryReadOptions,\r\n  GQueryResult,\r\n  ValueRenderOption,\r\n  DateTimeRenderOption,\r\n  GQueryRow,\r\n} from \"./types\";\r\nimport { parseRows } from \"./utils\";\r\n\r\n/**\r\n * Convert row values to appropriate types (boolean, date, number)\r\n * Optimized to reduce redundant type checking\r\n */\r\nfunction convertRowTypes(row: GQueryRow, headers: string[]): GQueryRow {\r\n  const newRow: GQueryRow = { __meta: row.__meta };\r\n  \r\n  headers.forEach((header) => {\r\n    let value = row[header];\r\n    \r\n    // Skip empty values\r\n    if (value === undefined || value === null || value === \"\") {\r\n      newRow[header] = value;\r\n      return;\r\n    }\r\n    \r\n    // Only process string values for type conversion\r\n    if (typeof value === \"string\") {\r\n      const lowerValue = value.toLowerCase();\r\n      \r\n      // Check for boolean\r\n      if (lowerValue === \"true\" || lowerValue === \"false\") {\r\n        newRow[header] = lowerValue === \"true\";\r\n        return;\r\n      }\r\n      \r\n      // Check for date pattern (MM/DD/YYYY or MM/DD/YYYY HH:MM:SS)\r\n      if (/^\\d{1,2}\\/\\d{1,2}\\/\\d{4}(\\s\\d{1,2}:\\d{1,2}(:\\d{1,2})?)?$/.test(value)) {\r\n        const dateValue = new Date(value);\r\n        if (!isNaN(dateValue.getTime())) {\r\n          newRow[header] = dateValue;\r\n          return;\r\n        }\r\n      }\r\n    }\r\n    \r\n    // Keep original value if no conversion applied\r\n    newRow[header] = value;\r\n  });\r\n  \r\n  return newRow;\r\n}\r\n\r\nexport function getManyInternal(\r\n  gquery: GQuery,\r\n  sheetNames: string[],\r\n  options?: GQueryReadOptions\r\n): {\r\n  [sheetName: string]: GQueryResult;\r\n} {\r\n  if (!sheetNames || sheetNames.length === 0) {\r\n    return {};\r\n  }\r\n\r\n  const valueRenderOption =\r\n    options?.valueRenderOption || ValueRenderOption.FORMATTED_VALUE;\r\n  const dateTimeRenderOption =\r\n    options?.dateTimeRenderOption || DateTimeRenderOption.FORMATTED_STRING;\r\n\r\n  const result: { [sheetName: string]: GQueryResult } = {};\r\n\r\n  // Fetch data using batchGet for better performance\r\n  const dataResponse = callHandler(() =>\r\n    Sheets.Spreadsheets!.Values!.batchGet(gquery.spreadsheetId, {\r\n      ranges: sheetNames,\r\n      valueRenderOption,\r\n      dateTimeRenderOption,\r\n    })\r\n  );\r\n\r\n  if (!dataResponse || !dataResponse.valueRanges) {\r\n    sheetNames.forEach((sheet) => {\r\n      result[sheet] = { headers: [], rows: [] };\r\n    });\r\n    return result;\r\n  }\r\n\r\n  dataResponse.valueRanges.forEach((valueRange, index) => {\r\n    const sheetName = sheetNames[index];\r\n\r\n    if (!valueRange.values || valueRange.values.length === 0) {\r\n      result[sheetName] = { headers: [], rows: [] };\r\n      return;\r\n    }\r\n\r\n    const headers = valueRange.values[0].map((h) => String(h));\r\n    let rows = parseRows(headers, valueRange.values.slice(1));\r\n\r\n    // Apply type conversion to rows\r\n    rows = rows.map((row) => convertRowTypes(row, headers));\r\n\r\n    result[sheetName] = { headers, rows };\r\n  });\r\n\r\n  return result;\r\n}\r\n\r\nexport function getInternal(\r\n  gqueryTableFactory: GQueryTableFactory,\r\n  options?: GQueryReadOptions\r\n): GQueryResult {\r\n  const gqueryTable = gqueryTableFactory.gQueryTable;\r\n  const gquery = gqueryTable.gquery;\r\n  // Determine which sheets we need to read from\r\n  const sheetsToRead = [gqueryTable.sheetName];\r\n\r\n  // Add all join sheets\r\n  if (gqueryTableFactory.joinOption.length > 0) {\r\n    gqueryTableFactory.joinOption.forEach((join) => {\r\n      if (!sheetsToRead.includes(join.sheetName)) {\r\n        sheetsToRead.push(join.sheetName);\r\n      }\r\n    });\r\n  }\r\n\r\n  // Read data from all required sheets at once\r\n  const results = gquery.getMany(sheetsToRead, options);\r\n\r\n  // If the main sheet doesn't exist or has no data\r\n  if (\r\n    !results[gqueryTable.sheetName] ||\r\n    results[gqueryTable.sheetName].rows.length === 0\r\n  ) {\r\n    return { headers: [], rows: [] };\r\n  }\r\n\r\n  // Get data for the primary table\r\n  let result = results[gqueryTable.sheetName];\r\n  let rows = result.rows;\r\n  let headers = result.headers;\r\n\r\n  // Process each join sequentially\r\n  if (gqueryTableFactory.joinOption.length > 0) {\r\n    gqueryTableFactory.joinOption.forEach((joinConfig) => {\r\n      const { sheetName, sheetColumn, joinColumn, columnsToReturn } =\r\n        joinConfig;\r\n\r\n      const joinData = results[sheetName];\r\n\r\n      if (!joinData || !joinData.rows || joinData.rows.length === 0) {\r\n        return; // Skip this join\r\n      }\r\n\r\n      // Create join lookup table\r\n      const joinMap: Record<string, any[]> = {};\r\n\r\n      // Check if the join column exists in the join table\r\n      const joinHeaders = joinData.headers;\r\n      if (!joinHeaders.includes(sheetColumn)) {\r\n        return; // Skip this join\r\n      }\r\n\r\n      joinData.rows.forEach((joinRow) => {\r\n        const joinKey = String(joinRow[sheetColumn]);\r\n        if (!joinMap[joinKey]) {\r\n          joinMap[joinKey] = [];\r\n        }\r\n        joinMap[joinKey].push(joinRow);\r\n      });\r\n\r\n      // Perform the join operation\r\n      rows = rows.map((row) => {\r\n        const localJoinValue = row[joinColumn];\r\n        const joinedRows = joinMap[String(localJoinValue)] || [];\r\n\r\n        // Create joined row with all join table fields\r\n        const joinedRow = { ...row };\r\n\r\n        joinedRows.forEach((joinRow, index) => {\r\n          // Determine which columns to include from join\r\n          const columnsToInclude =\r\n            columnsToReturn ||\r\n            Object.keys(joinRow).filter(\r\n              (key) => key !== \"__meta\" && key !== sheetColumn\r\n            );\r\n\r\n          columnsToInclude.forEach((key) => {\r\n            if (joinRow.hasOwnProperty(key) && key !== \"__meta\") {\r\n              // For multiple joined rows, add suffix _1, _2, etc.\r\n              const suffix = joinedRows.length > 1 ? `_${index + 1}` : \"\";\r\n              const targetKey = key === sheetColumn ? key : `${key}${suffix}`;\r\n              joinedRow[targetKey] = joinRow[key];\r\n            }\r\n          });\r\n        });\r\n\r\n        return joinedRow;\r\n      });\r\n    });\r\n  }\r\n\r\n  // Apply filter if specified\r\n  if (gqueryTableFactory.filterOption) {\r\n    rows = rows.filter(gqueryTableFactory.filterOption);\r\n  }\r\n\r\n  // Apply select if specified\r\n  if (\r\n    gqueryTableFactory.selectOption &&\r\n    gqueryTableFactory.selectOption.length > 0\r\n  ) {\r\n    // Create a map to track columns from joined tables\r\n    const joinedColumns = new Set<string>();\r\n\r\n    // Collect all columns from joined tables\r\n    rows.forEach((row) => {\r\n      Object.keys(row).forEach((key) => {\r\n        // If the column is not in the original headers, it's from a join\r\n        if (!headers.includes(key) && key !== \"__meta\") {\r\n          joinedColumns.add(key);\r\n        }\r\n      });\r\n    });\r\n\r\n    // If we have a select option, determine which columns to keep\r\n    let selectedHeaders: string[];\r\n\r\n    // Check if any of the selected headers is \"Model\" or \"Model_Name\"\r\n    // If we're selecting the join columns, we want to include all related joined fields\r\n    if (\r\n      gqueryTableFactory.selectOption.some(\r\n        (header) =>\r\n          header === \"Model\" ||\r\n          header === \"Model_Name\" ||\r\n          gqueryTableFactory.joinOption.some(\r\n            (j) => j.joinColumn === header || j.sheetColumn === header\r\n          )\r\n      )\r\n    ) {\r\n      // Include all join-related columns and the selected columns\r\n      selectedHeaders = [...gqueryTableFactory.selectOption];\r\n      joinedColumns.forEach((joinCol) => {\r\n        selectedHeaders.push(joinCol);\r\n      });\r\n    } else {\r\n      // Otherwise only include explicitly selected columns\r\n      selectedHeaders = [...gqueryTableFactory.selectOption];\r\n    }\r\n\r\n    // Remove duplicates\r\n    selectedHeaders = [...new Set(selectedHeaders)];\r\n\r\n    // Filter rows to only include selected columns\r\n    rows = rows.map((row) => {\r\n      const selectedRow: GQueryRow = {\r\n        __meta: row.__meta,\r\n      };\r\n\r\n      selectedHeaders.forEach((header) => {\r\n        if (row.hasOwnProperty(header)) {\r\n          selectedRow[header] = row[header];\r\n        }\r\n      });\r\n\r\n      return selectedRow;\r\n    });\r\n\r\n    // Update headers to include both selected and joined columns\r\n    return {\r\n      headers: selectedHeaders,\r\n      rows,\r\n    };\r\n  }\r\n\r\n  return {\r\n    headers,\r\n    rows,\r\n  };\r\n}\r\n\r\nexport function queryInternal(\r\n  gqueryTable: GQueryTable,\r\n  query: string\r\n): GQueryResult {\r\n  const sheet = gqueryTable.sheet;\r\n  const range = sheet.getDataRange();\r\n  \r\n  // Build column name to letter mapping\r\n  let replaced = query;\r\n  const lastColumn = range.getLastColumn();\r\n  \r\n  for (let i = 0; i < lastColumn; i++) {\r\n    const rng = sheet.getRange(1, i + 1);\r\n    const name = rng.getValue();\r\n    const letter = rng.getA1Notation().match(/([A-Z]+)/)?.[0];\r\n    \r\n    if (letter && name) {\r\n      replaced = replaced.replaceAll(name, letter);\r\n    }\r\n  }\r\n\r\n  // Build query URL\r\n  const url = Utilities.formatString(\r\n    \"https://docs.google.com/spreadsheets/d/%s/gviz/tq?tq=%s&sheet=%s%s&headers=1\",\r\n    sheet.getParent().getId(),\r\n    encodeURIComponent(replaced),\r\n    sheet.getName(),\r\n    typeof range === \"string\" ? \"&range=\" + range : \"\"\r\n  );\r\n\r\n  // Fetch with authorization\r\n  const response = UrlFetchApp.fetch(url, {\r\n    headers: {\r\n      Authorization: \"Bearer \" + ScriptApp.getOAuthToken(),\r\n    },\r\n  });\r\n\r\n  // Parse response\r\n  const jsonResponse = JSON.parse(\r\n    response\r\n      .getContentText()\r\n      .replace(\"/*O_o*/\\n\", \"\")\r\n      .replace(/(google\\.visualization\\.Query\\.setResponse\\()|(\\);)/gm, \"\")\r\n  );\r\n  \r\n  const table = jsonResponse.table;\r\n\r\n  // Extract column headers\r\n  const headers = table.cols.map((col: any) => col.label);\r\n\r\n  // Map rows to proper GQueryRow format\r\n  const rows = table.rows.map((row: any) => {\r\n    const rowObj: GQueryRow = {\r\n      __meta: {\r\n        rowNum: -1, // Query results don't have reliable row numbers\r\n        colLength: row.c.length,\r\n      },\r\n    };\r\n\r\n    // Populate row data\r\n    table.cols.forEach((col: any, colIndex: number) => {\r\n      const cellData = row.c[colIndex];\r\n      let value: any = \"\";\r\n      \r\n      if (cellData) {\r\n        // Use formatted value if available, otherwise use raw value\r\n        value = cellData.f !== null && cellData.f !== undefined\r\n          ? cellData.f\r\n          : cellData.v;\r\n\r\n        // Convert date strings if needed\r\n        if (typeof value === \"string\" && \r\n            /^\\d{1,2}\\/\\d{1,2}\\/\\d{4}(\\s\\d{1,2}:\\d{1,2}(:\\d{1,2})?)?$/.test(value)) {\r\n          const dateValue = new Date(value);\r\n          if (!isNaN(dateValue.getTime())) {\r\n            value = dateValue;\r\n          }\r\n        }\r\n      }\r\n      \r\n      rowObj[col.label] = value;\r\n    });\r\n\r\n    return rowObj;\r\n  });\r\n\r\n  return {\r\n    headers,\r\n    rows,\r\n  };\r\n}\r\n","import { GQueryTableFactory } from \"./index\";\r\nimport { callHandler } from \"./ratelimit\";\r\nimport { GQueryResult, GQueryRow } from \"./types\";\r\nimport { fetchSheetData } from \"./utils\";\r\n\r\nexport function updateInternal(\r\n  gQueryTableFactory: GQueryTableFactory,\r\n  updateFn: (row: Record<string, any>) => Record<string, any>\r\n): GQueryResult {\r\n  const spreadsheetId = gQueryTableFactory.gQueryTable.spreadsheetId;\r\n  const sheetName = gQueryTableFactory.gQueryTable.sheetName;\r\n  const range = sheetName;\r\n\r\n  const { headers, rows } = fetchSheetData(spreadsheetId, range);\r\n\r\n  if (headers.length === 0) {\r\n    return { rows: [], headers: [] };\r\n  }\r\n\r\n  // Filter rows if filter is specified\r\n  const filteredRows = gQueryTableFactory.filterOption\r\n    ? rows.filter((row) => {\r\n        try {\r\n          return gQueryTableFactory.filterOption!(row);\r\n        } catch (error) {\r\n          console.error(\"Error filtering row:\", error);\r\n          return false;\r\n        }\r\n      })\r\n    : rows;\r\n\r\n  // Apply updates to filtered rows\r\n  const updatedRows: GQueryRow[] = filteredRows.map((row) => {\r\n    const updatedRow: GQueryRow = { ...row };\r\n    try {\r\n      const result = updateFn(updatedRow);\r\n      if (result && typeof result === \"object\") {\r\n        Object.assign(updatedRow, result);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error updating row:\", error);\r\n    }\r\n    return updatedRow;\r\n  });\r\n\r\n  // Collect changed cells\r\n  const changedCells = new Map<string, any[]>();\r\n\r\n  updatedRows.forEach((updatedRow) => {\r\n    const rowIndex = updatedRow.__meta.rowNum - 2;\r\n    const originalRow = rows[rowIndex];\r\n\r\n    headers.forEach((header, columnIndex) => {\r\n      let updatedValue = updatedRow[header];\r\n      const originalValue = originalRow[header];\r\n\r\n      // Convert dates to locale string for comparison\r\n      if (updatedValue instanceof Date) {\r\n        updatedValue = updatedValue.toLocaleString();\r\n      }\r\n\r\n      // Skip if values are the same\r\n      if (originalValue === updatedValue) return;\r\n\r\n      // Only update if value changed or is being set/cleared\r\n      if (updatedValue !== undefined && updatedValue !== null) {\r\n        const columnLetter = getColumnLetter(columnIndex);\r\n        const cellRange = `${sheetName}!${columnLetter}${updatedRow.__meta.rowNum}`;\r\n        changedCells.set(cellRange, [[updatedValue]]);\r\n      } else if (originalValue !== undefined && originalValue !== null) {\r\n        const columnLetter = getColumnLetter(columnIndex);\r\n        const cellRange = `${sheetName}!${columnLetter}${updatedRow.__meta.rowNum}`;\r\n        changedCells.set(cellRange, [[updatedValue || \"\"]]);\r\n      }\r\n    });\r\n  });\r\n\r\n  // Perform batch update if there are changes\r\n  if (changedCells.size > 0) {\r\n    const optimizedUpdates = optimizeRanges(changedCells);\r\n\r\n    const batchUpdateRequest = {\r\n      data: optimizedUpdates,\r\n      valueInputOption: \"USER_ENTERED\",\r\n    };\r\n\r\n    callHandler(() =>\r\n      Sheets.Spreadsheets!.Values!.batchUpdate(batchUpdateRequest, spreadsheetId)\r\n    );\r\n  }\r\n\r\n  return {\r\n    rows: filteredRows.length > 0 ? updatedRows : [],\r\n    headers,\r\n  };\r\n}\r\n\r\n/**\r\n * Convert column index to column letter (0 -> A, 1 -> B, etc.)\r\n */\r\nfunction getColumnLetter(columnIndex: number): string {\r\n  let columnLetter = \"\";\r\n  let index = columnIndex;\r\n\r\n  while (index >= 0) {\r\n    columnLetter = String.fromCharCode(65 + (index % 26)) + columnLetter;\r\n    index = Math.floor(index / 26) - 1;\r\n  }\r\n\r\n  return columnLetter;\r\n}\r\n\r\n/**\r\n * Optimize update ranges by combining adjacent cells in the same column\r\n * into contiguous row segments.\r\n */\r\nfunction optimizeRanges(\r\n  changedCells: Map<string, any[]>\r\n): { range: string; values: any[][] }[] {\r\n  const columnGroups = new Map<string, Map<number, any>>();\r\n\r\n  for (const [cellRange, value] of changedCells.entries()) {\r\n    const matches = cellRange.match(/([^!]+)!([A-Z]+)(\\d+)$/);\r\n    if (!matches) continue;\r\n\r\n    const sheet = matches[1];\r\n    const columnLetter = matches[2];\r\n    const rowNumber = parseInt(matches[3], 10);\r\n    const columnKey = `${sheet}!${columnLetter}`;\r\n\r\n    if (!columnGroups.has(columnKey)) {\r\n      columnGroups.set(columnKey, new Map());\r\n    }\r\n    columnGroups.get(columnKey)!.set(rowNumber, value[0][0]);\r\n  }\r\n\r\n  const optimizedUpdates: { range: string; values: any[][] }[] = [];\r\n\r\n  for (const [columnKey, rowsMap] of columnGroups.entries()) {\r\n    const rowNumbers = Array.from(rowsMap.keys()).sort((a, b) => a - b);\r\n    if (rowNumbers.length === 0) continue;\r\n\r\n    const [sheet, column] = columnKey.split(\"!\");\r\n\r\n    let start = rowNumbers[0];\r\n    let groupValues: any[][] = [[rowsMap.get(start)]];\r\n\r\n    for (let i = 1; i < rowNumbers.length; i++) {\r\n      const rowNum = rowNumbers[i];\r\n      const prev = rowNumbers[i - 1];\r\n      if (rowNum === prev + 1) {\r\n        groupValues.push([rowsMap.get(rowNum)]);\r\n      } else {\r\n        const end = prev;\r\n        const rangeKey =\r\n          start === end\r\n            ? `${sheet}!${column}${start}`\r\n            : `${sheet}!${column}${start}:${column}${end}`;\r\n        optimizedUpdates.push({ range: rangeKey, values: groupValues });\r\n        start = rowNum;\r\n        groupValues = [[rowsMap.get(rowNum)]];\r\n      }\r\n    }\r\n\r\n    const last = rowNumbers[rowNumbers.length - 1];\r\n    const rangeKey =\r\n      start === last\r\n        ? `${sheet}!${column}${start}`\r\n        : `${sheet}!${column}${start}:${column}${last}`;\r\n    optimizedUpdates.push({ range: rangeKey, values: groupValues });\r\n  }\r\n\r\n  return optimizedUpdates;\r\n}\r\n","import { GQueryTable } from \"./index\";\r\nimport { callHandler } from \"./ratelimit\";\r\nimport { GQueryResult, GQueryRow } from \"./types\";\r\n\r\nexport function appendInternal(\r\n  table: GQueryTable,\r\n  data: { [key: string]: any }[]\r\n): GQueryResult {\r\n  // Validate input data\r\n  if (!data || data.length === 0) {\r\n    return { rows: [], headers: [] };\r\n  }\r\n\r\n  const spreadsheetId = table.spreadsheetId;\r\n  const sheetName = table.sheetName;\r\n\r\n  // Fetch headers from the first row\r\n  const response = callHandler(() =>\r\n    Sheets.Spreadsheets!.Values!.get(spreadsheetId, `${sheetName}!1:1`)\r\n  );\r\n\r\n  // Validate sheet exists and has headers\r\n  if (!response || !response.values || response.values.length === 0) {\r\n    throw new Error(`Sheet \"${sheetName}\" not found or has no headers`);\r\n  }\r\n\r\n  const headers = response.values[0].map((header) => String(header));\r\n\r\n  // Map data to rows according to header order\r\n  const rowsToAppend = data.map((item) => {\r\n    return headers.map((header) => {\r\n      let value = item[header];\r\n\r\n      // Convert Date objects to locale strings\r\n      if (value instanceof Date) {\r\n        value = value.toLocaleString();\r\n      }\r\n\r\n      return value !== undefined ? value : \"\";\r\n    });\r\n  });\r\n\r\n  // Append data using Sheets API\r\n  const appendResponse = callHandler(() =>\r\n    Sheets.Spreadsheets!.Values!.append(\r\n      { values: rowsToAppend },\r\n      spreadsheetId,\r\n      sheetName,\r\n      {\r\n        valueInputOption: \"USER_ENTERED\",\r\n        insertDataOption: \"OVERWRITE\",\r\n        responseValueRenderOption: \"FORMATTED_VALUE\",\r\n        responseDateTimeRenderOption: \"FORMATTED_STRING\",\r\n        includeValuesInResponse: true,\r\n      }\r\n    )\r\n  );\r\n\r\n  // Validate append was successful\r\n  if (\r\n    !appendResponse ||\r\n    !appendResponse.updates ||\r\n    !appendResponse.updates.updatedRange\r\n  ) {\r\n    throw new Error(\"Failed to append data to sheet\");\r\n  }\r\n\r\n  // Parse the updated range to get row numbers\r\n  const updatedRange = appendResponse.updates.updatedRange;\r\n  const rangeMatch = updatedRange.match(/([^!]+)!([A-Z]+)(\\d+):([A-Z]+)(\\d+)/);\r\n\r\n  if (!rangeMatch) {\r\n    throw new Error(`Could not parse updated range: ${updatedRange}`);\r\n  }\r\n\r\n  const startRow = parseInt(rangeMatch[3], 10);\r\n  const endRow = parseInt(rangeMatch[5], 10);\r\n  \r\n  // Validate that all rows were appended\r\n  const expectedRowCount = data.length;\r\n  const actualRowCount = endRow - startRow + 1;\r\n  if (actualRowCount !== expectedRowCount) {\r\n    console.warn(\r\n      `Expected to append ${expectedRowCount} rows but ${actualRowCount} were appended`\r\n    );\r\n  }\r\n\r\n  // Create result rows with metadata\r\n  const resultRows: GQueryRow[] = rowsToAppend.map((row, index) => {\r\n    const rowObj: GQueryRow = {\r\n      __meta: {\r\n        rowNum: startRow + index,\r\n        colLength: headers.length,\r\n      },\r\n    };\r\n\r\n    // Map values to header names\r\n    headers.forEach((header, colIndex) => {\r\n      rowObj[header] = row[colIndex];\r\n    });\r\n\r\n    return rowObj;\r\n  });\r\n\r\n  return {\r\n    rows: resultRows,\r\n    headers,\r\n  };\r\n}\r\n","import { GQueryTableFactory } from \"./index\";\r\nimport { callHandler } from \"./ratelimit\";\r\nimport { fetchSheetData } from \"./utils\";\r\n\r\nexport function deleteInternal(gqueryTableFactory: GQueryTableFactory): {\r\n  deletedRows: number;\r\n} {\r\n  const spreadsheetId = gqueryTableFactory.gQueryTable.spreadsheetId;\r\n  const sheetName = gqueryTableFactory.gQueryTable.sheetName;\r\n  const sheet = gqueryTableFactory.gQueryTable.sheet;\r\n  const sheetId = sheet.getSheetId();\r\n\r\n  const { rows } = fetchSheetData(spreadsheetId, sheetName);\r\n\r\n  // Check if filter is specified and rows exist\r\n  if (!gqueryTableFactory.filterOption || rows.length === 0) {\r\n    return { deletedRows: 0 };\r\n  }\r\n\r\n  // Find rows matching the filter condition\r\n  const rowsToDelete = rows.filter((row) => {\r\n    try {\r\n      return gqueryTableFactory.filterOption!(row);\r\n    } catch (error) {\r\n      console.error(\"Error filtering row:\", error);\r\n      return false;\r\n    }\r\n  });\r\n\r\n  if (rowsToDelete.length === 0) {\r\n    return { deletedRows: 0 };\r\n  }\r\n\r\n  // Sort in descending order to avoid row number shifting issues\r\n  rowsToDelete.sort((a, b) => b.__meta.rowNum - a.__meta.rowNum);\r\n\r\n  // Build batch delete request\r\n  const batchUpdateRequest = {\r\n    requests: rowsToDelete.map((row) => ({\r\n      deleteDimension: {\r\n        range: {\r\n          sheetId,\r\n          dimension: \"ROWS\",\r\n          startIndex: row.__meta.rowNum - 1, // Convert to 0-based index\r\n          endIndex: row.__meta.rowNum, // End-exclusive range\r\n        },\r\n      },\r\n    })),\r\n  };\r\n\r\n  // Execute batch delete\r\n  try {\r\n    callHandler(() =>\r\n      Sheets.Spreadsheets!.batchUpdate(batchUpdateRequest, spreadsheetId)\r\n    );\r\n    return { deletedRows: rowsToDelete.length };\r\n  } catch (error) {\r\n    console.error(\"Error deleting rows:\", error);\r\n    throw new Error(`Failed to delete rows: ${error}`);\r\n  }\r\n}\r\n","import { getInternal, getManyInternal, queryInternal } from \"./get\";\r\nimport { updateInternal } from \"./update\";\r\nimport { appendInternal } from \"./append\";\r\nimport { deleteInternal } from \"./delete\";\r\nimport { GQueryReadOptions, GQueryResult } from \"./types\";\r\n\r\nexport * from \"./types\";\r\n\r\n/**\r\n * Main GQuery class for interacting with Google Sheets\r\n * Provides a query-like interface for reading and writing spreadsheet data\r\n */\r\nexport class GQuery {\r\n  spreadsheetId: string;\r\n\r\n  /**\r\n   * Create a new GQuery instance\r\n   * @param spreadsheetId Optional spreadsheet ID. If not provided, uses the active spreadsheet\r\n   */\r\n  constructor(spreadsheetId?: string) {\r\n    this.spreadsheetId = spreadsheetId\r\n      ? spreadsheetId\r\n      : SpreadsheetApp.getActiveSpreadsheet().getId();\r\n  }\r\n\r\n  /**\r\n   * Get a table reference for a specific sheet\r\n   * @param sheetName Name of the sheet\r\n   * @returns GQueryTable instance for chaining operations\r\n   */\r\n  from(sheetName: string): GQueryTable {\r\n    return new GQueryTable(this, this.spreadsheetId, sheetName);\r\n  }\r\n\r\n  /**\r\n   * Efficiently fetch data from multiple sheets at once\r\n   * @param sheetNames Array of sheet names to fetch\r\n   * @param options Optional rendering options\r\n   * @returns Object mapping sheet names to their data\r\n   */\r\n  getMany(\r\n    sheetNames: string[],\r\n    options?: GQueryReadOptions\r\n  ): {\r\n    [sheetName: string]: GQueryResult;\r\n  } {\r\n    return getManyInternal(this, sheetNames, options);\r\n  }\r\n}\r\n\r\n/**\r\n * Represents a single sheet table for query operations\r\n */\r\nexport class GQueryTable {\r\n  gquery: GQuery;\r\n  spreadsheetId: string;\r\n  spreadsheet: GoogleAppsScript.Spreadsheet.Spreadsheet;\r\n  sheetName: string;\r\n  sheet: GoogleAppsScript.Spreadsheet.Sheet;\r\n\r\n  constructor(gquery: GQuery, spreadsheetId: string, sheetName: string) {\r\n    this.spreadsheetId = spreadsheetId;\r\n    this.sheetName = sheetName;\r\n    this.spreadsheet = SpreadsheetApp.openById(spreadsheetId);\r\n    this.sheet = this.spreadsheet.getSheetByName(sheetName)!;\r\n    this.gquery = gquery;\r\n  }\r\n\r\n  /**\r\n   * Select specific columns to return\r\n   * @param headers Array of column names to select\r\n   * @returns GQueryTableFactory for chaining\r\n   */\r\n  select(headers: string[]): GQueryTableFactory {\r\n    return new GQueryTableFactory(this).select(headers);\r\n  }\r\n\r\n  /**\r\n   * Filter rows based on a condition\r\n   * @param filterFn Function that returns true for rows to include\r\n   * @returns GQueryTableFactory for chaining\r\n   */\r\n  where(filterFn: (row: any) => boolean): GQueryTableFactory {\r\n    return new GQueryTableFactory(this).where(filterFn);\r\n  }\r\n\r\n  /**\r\n   * Join with another sheet\r\n   * @param sheetName Name of sheet to join with\r\n   * @param sheetColumn Column in the joined sheet to match on\r\n   * @param joinColumn Column in this sheet to match on\r\n   * @param columnsToReturn Optional array of columns to return from joined sheet\r\n   * @returns GQueryTableFactory for chaining\r\n   */\r\n  join(\r\n    sheetName: string,\r\n    sheetColumn: string,\r\n    joinColumn: string,\r\n    columnsToReturn?: string[]\r\n  ): GQueryTableFactory {\r\n    return new GQueryTableFactory(this).join(\r\n      sheetName,\r\n      sheetColumn,\r\n      joinColumn,\r\n      columnsToReturn\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Update rows in the sheet\r\n   * @param updateFn Function that receives a row and returns updated values\r\n   * @returns GQueryResult with updated rows\r\n   */\r\n  update(\r\n    updateFn: (row: Record<string, any>) => Record<string, any>\r\n  ): GQueryResult {\r\n    return new GQueryTableFactory(this).update(updateFn);\r\n  }\r\n\r\n  /**\r\n   * Append new rows to the sheet\r\n   * @param data Single object or array of objects to append\r\n   * @returns GQueryResult with appended rows\r\n   */\r\n  append(\r\n    data: { [key: string]: any }[] | { [key: string]: any }\r\n  ): GQueryResult {\r\n    const dataArray = Array.isArray(data) ? data : [data];\r\n    return appendInternal(this, dataArray);\r\n  }\r\n\r\n  /**\r\n   * Get data from the sheet\r\n   * @param options Optional rendering options\r\n   * @returns GQueryResult with rows and headers\r\n   */\r\n  get(options?: GQueryReadOptions): GQueryResult {\r\n    return new GQueryTableFactory(this).get(options);\r\n  }\r\n\r\n  /**\r\n   * Execute a Google Visualization API query\r\n   * @param query Query string in Google Query Language\r\n   * @returns GQueryResult with query results\r\n   */\r\n  query(query: string): GQueryResult {\r\n    return queryInternal(this, query);\r\n  }\r\n\r\n  /**\r\n   * Delete rows from the sheet\r\n   * @returns Object with count of deleted rows\r\n   */\r\n  delete(): { deletedRows: number } {\r\n    return new GQueryTableFactory(this).delete();\r\n  }\r\n}\r\n\r\n/**\r\n * Factory class for building and executing queries with filters and joins\r\n */\r\nexport class GQueryTableFactory {\r\n  gQueryTable: GQueryTable;\r\n  selectOption?: string[];\r\n  filterOption?: (row: any) => boolean;\r\n  joinOption: {\r\n    sheetName: string;\r\n    sheetColumn: string;\r\n    joinColumn: string;\r\n    columnsToReturn?: string[];\r\n  }[] = [];\r\n\r\n  constructor(GQueryTable: GQueryTable) {\r\n    this.gQueryTable = GQueryTable;\r\n  }\r\n\r\n  select(headers: string[]): GQueryTableFactory {\r\n    this.selectOption = headers;\r\n    return this;\r\n  }\r\n\r\n  where(filterFn: (row: any) => boolean): GQueryTableFactory {\r\n    this.filterOption = filterFn;\r\n    return this;\r\n  }\r\n\r\n  join(\r\n    sheetName: string,\r\n    sheetColumn: string,\r\n    joinColumn: string,\r\n    columnsToReturn?: string[]\r\n  ): GQueryTableFactory {\r\n    this.joinOption.push({\r\n      sheetName,\r\n      sheetColumn,\r\n      joinColumn,\r\n      columnsToReturn,\r\n    });\r\n    return this;\r\n  }\r\n\r\n  get(options?: GQueryReadOptions): GQueryResult {\r\n    return getInternal(this, options);\r\n  }\r\n\r\n  update(\r\n    updateFn: (row: Record<string, any>) => Record<string, any>\r\n  ): GQueryResult {\r\n    return updateInternal(this, updateFn);\r\n  }\r\n\r\n  append(\r\n    data: { [key: string]: any }[] | { [key: string]: any }\r\n  ): GQueryResult {\r\n    const dataArray = Array.isArray(data) ? data : [data];\r\n    return appendInternal(this.gQueryTable, dataArray);\r\n  }\r\n\r\n  delete(): { deletedRows: number } {\r\n    return deleteInternal(this);\r\n  }\r\n}\r\n"],"names":["ValueRenderOption","DateTimeRenderOption"],"mappings":"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"}